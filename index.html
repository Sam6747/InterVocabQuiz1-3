<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Global Edu ‚Äî Vocabulary Quiz</title>
<link href="https://fonts.googleapis.com/css2?family=Fraunces:ital,wght@0,400;0,700;0,900;1,400;1,700&family=Plus+Jakarta+Sans:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet">
<style>
:root {
  --bg:      #f6f3ee;
  --surface: #ffffff;
  --card:    #fdfcfa;
  --ink:     #1c1814;
  --ink2:    #4a4540;
  --muted:   #9a938a;
  --border:  #e6dfd5;
  --red:     #c0390a;
  --green:   #1f6b48;
  --blue:    #1a4a8a;
  --c-bg:    #ebf5f0;
  --w-bg:    #fbede9;
  --shadow:    0 2px 16px rgba(28,24,20,.07);
  --shadow-lg: 0 8px 48px rgba(28,24,20,.13);
  --r: 14px;
}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html{scroll-behavior:smooth}
body{background:var(--bg);color:var(--ink);font-family:'Plus Jakarta Sans',sans-serif;font-size:16px;line-height:1.55;min-height:100vh}
body::before{content:'';position:fixed;inset:0;z-index:0;
  background-image:linear-gradient(rgba(200,170,130,.07) 1px,transparent 1px),linear-gradient(90deg,rgba(200,170,130,.07) 1px,transparent 1px);
  background-size:40px 40px;pointer-events:none}
.wrap{position:relative;z-index:1;max-width:760px;margin:0 auto;padding:0 20px 80px}

/* screens */
.screen{display:none}
.screen.active{display:block;animation:fadeUp .35s ease}
@keyframes fadeUp{from{opacity:0;transform:translateY(14px)}to{opacity:1;transform:translateY(0)}}

/* ‚îÄ‚îÄ SETUP ‚îÄ‚îÄ */
.setup-card{background:var(--surface);border:1px solid var(--border);border-radius:22px;padding:52px 52px 44px;margin-top:52px;box-shadow:var(--shadow-lg)}
.brand{display:flex;align-items:center;gap:10px;margin-bottom:38px}
.brand-mark{width:38px;height:38px;background:var(--ink);border-radius:10px;display:flex;align-items:center;justify-content:center}
.brand-mark svg{width:20px;height:20px;stroke:#fff;fill:none;stroke-width:2;stroke-linecap:round;stroke-linejoin:round}
.brand-name{font-family:'Fraunces',serif;font-size:17px;font-weight:700;letter-spacing:-.3px}
.setup-headline{font-family:'Fraunces',serif;font-size:clamp(36px,6vw,54px);font-weight:900;line-height:1.05;letter-spacing:-2px;margin-bottom:10px}
.setup-headline em{font-style:italic;color:var(--red)}
.setup-sub{color:var(--muted);font-size:15px;margin-bottom:40px}
.field{margin-bottom:22px}
.field-label{display:block;font-size:11px;font-weight:700;letter-spacing:1.8px;text-transform:uppercase;color:var(--muted);margin-bottom:8px}
.text-input{width:100%;padding:13px 17px;border:1.5px solid var(--border);border-radius:var(--r);font-family:'Plus Jakarta Sans',sans-serif;font-size:16px;color:var(--ink);background:var(--card);outline:none;transition:border-color .18s,box-shadow .18s}
.text-input:focus{border-color:var(--red);box-shadow:0 0 0 3px rgba(192,57,10,.1)}
.unit-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:9px}
.unit-tile{padding:14px 8px;border:1.5px solid var(--border);border-radius:var(--r);background:var(--card);font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;font-weight:600;color:var(--ink2);cursor:pointer;text-align:center;transition:all .15s;line-height:1.3}
.unit-tile small{display:block;font-size:10px;font-weight:400;opacity:.65;margin-top:2px}
.unit-tile:hover{border-color:var(--red);color:var(--red);background:#fdf4f1}
.unit-tile.on{border-color:var(--red);background:var(--red);color:#fff}
.unit-tile.on small{opacity:.85}
.start-btn{width:100%;margin-top:10px;padding:17px;background:var(--ink);color:#fff;border:none;border-radius:var(--r);font-family:'Plus Jakarta Sans',sans-serif;font-size:16px;font-weight:700;letter-spacing:.2px;cursor:pointer;transition:all .18s}
.start-btn:hover:not(:disabled){background:var(--red);transform:translateY(-1px);box-shadow:var(--shadow)}
.start-btn:disabled{background:var(--border);color:var(--muted);cursor:not-allowed}

/* ‚îÄ‚îÄ ACCORDION ‚îÄ‚îÄ */
.acc{background:var(--surface);border:1px solid var(--border);border-radius:18px;margin-top:20px;box-shadow:var(--shadow);overflow:hidden}
.acc-trigger{width:100%;padding:20px 28px;display:flex;align-items:center;justify-content:space-between;background:none;border:none;cursor:pointer;font-family:'Plus Jakarta Sans',sans-serif;font-size:15px;font-weight:600;color:var(--ink2);text-align:left;transition:background .15s}
.acc-trigger:hover{background:var(--card)}
.acc-trigger .chev{transition:transform .25s;flex-shrink:0}
.acc.open .chev{transform:rotate(180deg)}
.acc-body{display:none;padding:0 28px 28px}
.acc.open .acc-body{display:block}
.step-row{display:flex;gap:14px;margin-top:16px}
.step-num{width:26px;height:26px;flex-shrink:0;background:var(--ink);color:#fff;border-radius:50%;font-size:12px;font-weight:700;display:flex;align-items:center;justify-content:center;margin-top:2px}
.step-txt{font-size:14px;color:var(--ink2);line-height:1.65}
.step-txt strong{color:var(--ink);display:block;margin-bottom:3px;font-weight:600}
.step-txt a{color:var(--red)}
.code-block{background:#1c1814;color:#a8e8c0;padding:16px 18px;border-radius:10px;font-family:'JetBrains Mono',monospace;font-size:11px;line-height:1.75;margin-top:10px;white-space:pre;overflow-x:auto}
.wh-row{display:flex;gap:8px;margin-top:10px;flex-wrap:wrap}
.wh-in{flex:1;min-width:200px;padding:10px 14px;border:1.5px solid var(--border);border-radius:10px;font-family:'JetBrains Mono',monospace;font-size:11.5px;color:var(--ink);outline:none;transition:border-color .15s}
.wh-in:focus{border-color:var(--red)}
.save-wh{padding:10px 18px;background:var(--green);color:#fff;border:none;border-radius:10px;font-size:13px;font-weight:700;cursor:pointer;white-space:nowrap;transition:opacity .15s}
.save-wh:hover{opacity:.88}
.wh-ok{font-size:13px;color:var(--green);font-weight:600;margin-top:7px;display:none}

/* ‚îÄ‚îÄ QUIZ HEADER ‚îÄ‚îÄ */
.quiz-top{display:flex;align-items:center;justify-content:space-between;padding:28px 0 0;margin-bottom:20px;flex-wrap:wrap;gap:10px}
.q-label{font-family:'JetBrains Mono',monospace;font-size:13px;color:var(--muted)}
.q-label strong{color:var(--ink)}
.chips{display:flex;gap:10px}
.chip{display:flex;align-items:center;gap:5px;padding:5px 12px;border:1.5px solid var(--border);border-radius:99px;font-family:'JetBrains Mono',monospace;font-size:12px;font-weight:700;background:var(--surface);transition:all .2s}
.chip.c{border-color:var(--green);color:var(--green);background:var(--c-bg)}
.chip.w{border-color:var(--red);color:var(--red);background:var(--w-bg)}
.tmr{font-family:'JetBrains Mono',monospace;font-size:13px;color:var(--muted);font-weight:500}
.prog-track{height:4px;background:var(--border);border-radius:99px;overflow:hidden;margin-bottom:24px}
.prog-fill{height:100%;background:linear-gradient(90deg,var(--red),var(--green));border-radius:99px;width:0%;transition:width .5s cubic-bezier(.4,0,.2,1)}

/* ‚îÄ‚îÄ QUESTION CARD ‚îÄ‚îÄ */
.q-card{background:var(--surface);border:1px solid var(--border);border-radius:20px;padding:38px 42px 34px;box-shadow:var(--shadow);animation:fadeUp .3s ease}
.q-badge{display:inline-flex;align-items:center;gap:6px;font-size:10px;font-weight:700;letter-spacing:1.8px;text-transform:uppercase;color:var(--muted);border:1px solid var(--border);border-radius:99px;padding:4px 11px;margin-bottom:18px}
.q-badge-dot{width:6px;height:6px;border-radius:50%}
.q-unit{font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--muted);margin-bottom:6px}
.q-stem{font-family:'Fraunces',serif;font-size:clamp(20px,3.5vw,26px);font-weight:700;line-height:1.3;letter-spacing:-.4px;color:var(--ink);margin-bottom:26px}
.q-stem em{font-style:italic;color:var(--red)}
.q-stem .def{font-size:.88em;font-weight:400;font-style:italic;color:var(--ink2)}
.q-stem .hint{display:block;font-family:'Plus Jakarta Sans',sans-serif;font-size:14px;font-weight:400;font-style:normal;color:var(--muted);margin-top:8px}
.mc-grid{display:grid;grid-template-columns:1fr 1fr;gap:9px}
@media(max-width:500px){.mc-grid{grid-template-columns:1fr}}
.mc-opt{display:flex;align-items:flex-start;gap:11px;padding:13px 16px;border:1.5px solid var(--border);border-radius:var(--r);background:var(--card);font-family:'Plus Jakarta Sans',sans-serif;font-size:14px;font-weight:500;color:var(--ink);cursor:pointer;text-align:left;line-height:1.4;transition:all .14s}
.mc-opt:hover:not(:disabled){border-color:var(--blue);background:#eef3fb}
.mc-opt .key{width:26px;height:26px;flex-shrink:0;background:var(--border);border-radius:6px;display:flex;align-items:center;justify-content:center;font-family:'JetBrains Mono',monospace;font-size:11px;font-weight:700;color:var(--muted);transition:all .14s}
.mc-opt:hover:not(:disabled) .key{background:var(--blue);color:#fff}
.mc-opt.correct{border-color:var(--green);background:var(--c-bg);color:var(--green)}
.mc-opt.correct .key{background:var(--green);color:#fff}
.mc-opt.wrong{border-color:var(--red);background:var(--w-bg);color:var(--red)}
.mc-opt.wrong .key{background:var(--red);color:#fff}
.mc-opt.dim{opacity:.3}
.mc-opt:disabled{cursor:default}
.tf-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.tf-btn{padding:22px 10px;border:1.5px solid var(--border);border-radius:var(--r);background:var(--card);font-family:'Fraunces',serif;font-size:24px;font-weight:900;color:var(--ink2);cursor:pointer;text-align:center;transition:all .14s}
.tf-btn:hover:not(:disabled){border-color:var(--blue);background:#eef3fb;transform:translateY(-2px)}
.tf-btn.correct{border-color:var(--green);background:var(--c-bg);color:var(--green)}
.tf-btn.wrong{border-color:var(--red);background:var(--w-bg);color:var(--red)}
.tf-btn:disabled{cursor:default}
.written-col{display:flex;flex-direction:column;gap:11px}
.written-in{width:100%;padding:15px 18px;border:1.5px solid var(--border);border-radius:var(--r);font-family:'Plus Jakarta Sans',sans-serif;font-size:18px;font-weight:600;color:var(--ink);background:var(--card);outline:none;transition:border-color .18s,box-shadow .18s}
.written-in:focus{border-color:var(--blue);box-shadow:0 0 0 3px rgba(26,74,138,.1)}
.written-in.correct{border-color:var(--green);background:var(--c-bg);color:var(--green)}
.written-in.wrong{border-color:var(--red);background:var(--w-bg);color:var(--red)}
.check-btn{align-self:flex-start;padding:13px 28px;background:var(--blue);color:#fff;border:none;border-radius:var(--r);font-family:'Plus Jakarta Sans',sans-serif;font-size:15px;font-weight:700;cursor:pointer;transition:all .14s}
.check-btn:hover:not(:disabled){background:var(--ink);transform:translateY(-1px)}
.check-btn:disabled{opacity:.5;cursor:default}
.fb{display:none;margin-top:16px;padding:13px 16px;border-radius:var(--r);font-size:14px;font-weight:600;align-items:center;gap:8px}
.fb.show{display:flex}
.fb.ok{background:var(--c-bg);border:1px solid #b0ddc4;color:var(--green)}
.fb.no{background:var(--w-bg);border:1px solid #edbbaa;color:var(--red)}
.fb .fb-ans{font-weight:400;color:var(--ink2);margin-left:4px}
.fb .fb-ans b{color:var(--ink);font-weight:600}

/* ‚îÄ‚îÄ RESULTS ‚îÄ‚îÄ */
.results-card{background:var(--surface);border:1px solid var(--border);border-radius:22px;padding:52px;margin-top:44px;box-shadow:var(--shadow-lg)}
.res-eye{font-size:11px;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:var(--muted);margin-bottom:8px}
.res-headline{font-family:'Fraunces',serif;font-size:clamp(38px,7vw,58px);font-weight:900;line-height:1.0;letter-spacing:-2px;margin-bottom:6px}
.res-headline em{font-style:italic;color:var(--red)}
.res-sub{font-size:14px;color:var(--muted);margin-bottom:32px}
.score-row{display:flex;align-items:baseline;gap:8px;margin-bottom:6px}
.score-n{font-family:'Fraunces',serif;font-size:88px;font-weight:900;color:var(--red);line-height:1;letter-spacing:-3px}
.score-d{font-family:'Fraunces',serif;font-size:40px;color:var(--muted)}
.score-pct{font-size:15px;color:var(--muted);margin-bottom:30px}
.stat-row{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:32px}
.stat-box{background:var(--card);border:1px solid var(--border);border-radius:var(--r);padding:18px;text-align:center}
.stat-v{font-family:'Fraunces',serif;font-size:30px;font-weight:900;color:var(--ink)}
.stat-l{font-size:10px;text-transform:uppercase;letter-spacing:1.2px;color:var(--muted);margin-top:3px}
.sep{font-size:11px;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:var(--muted);margin:28px 0 14px;padding-bottom:8px;border-bottom:1px solid var(--border)}
.type-rows{display:flex;flex-direction:column;gap:9px;margin-bottom:6px}
.type-row{display:flex;align-items:center;gap:12px;font-size:13px}
.type-name{width:185px;flex-shrink:0;color:var(--ink2);font-weight:500}
.type-track{flex:1;height:7px;background:var(--border);border-radius:99px;overflow:hidden}
.type-bar{height:100%;background:var(--green);border-radius:99px;transition:width 1.1s cubic-bezier(.4,0,.2,1)}
.type-num{width:44px;text-align:right;font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--muted)}
.hw-chips{display:flex;flex-wrap:wrap;gap:7px;margin-bottom:6px}
.hw-chip{padding:5px 13px;background:var(--w-bg);border:1px solid #edbbaa;border-radius:99px;font-size:13px;font-weight:600;color:var(--red)}
.hw-none{font-size:14px;color:var(--green);font-weight:600}
.sheets-badge{display:none;align-items:center;gap:9px;padding:13px 16px;border-radius:var(--r);font-size:13px;font-weight:600;margin-bottom:22px}
.sheets-badge.sending{background:#fff8e0;border:1px solid #e8c840;color:#7a6000;display:flex}
.sheets-badge.ok{background:var(--c-bg);border:1px solid #b0ddc4;color:var(--green);display:flex}
.sheets-badge.fail{background:var(--w-bg);border:1px solid #edbbaa;color:var(--red);display:flex}
.retry-btn{display:inline-flex;align-items:center;gap:8px;padding:15px 30px;background:var(--ink);color:#fff;border:none;border-radius:var(--r);font-family:'Plus Jakarta Sans',sans-serif;font-size:15px;font-weight:700;cursor:pointer;transition:all .15s}
.retry-btn:hover{background:var(--red);transform:translateY(-1px)}

@media(max-width:600px){
  .setup-card,.results-card{padding:28px 22px}
  .q-card{padding:24px 20px}
  .unit-grid{grid-template-columns:repeat(2,1fr)}
  .stat-row{grid-template-columns:repeat(2,1fr)}
  .score-n{font-size:64px}
}
</style>
</head>
<body>
<div class="wrap">

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SETUP ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="screen active" id="s-setup">
  <div class="setup-card">
    <div class="brand">
      <div class="brand-mark">
        <svg viewBox="0 0 24 24"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>
      </div>
      <span class="brand-name">Global Edu</span>
    </div>
    <h1 class="setup-headline">Vocabulary<br><em>Quiz</em></h1>
    <p class="setup-sub">Intermediate ¬∑ Units 1, 2 &amp; 3 ¬∑ 30 questions</p>

    <div class="field">
      <label class="field-label" for="sname">Your full name</label>
      <input class="text-input" id="sname" type="text" placeholder="e.g. Dilnoza Yusupova" autocomplete="off">
    </div>

    <div class="field">
      <label class="field-label">Choose unit</label>
      <div class="unit-grid">
        <button class="unit-tile" onclick="pickUnit(this,'1')">Unit 1<small>Learning</small></button>
        <button class="unit-tile" onclick="pickUnit(this,'2')">Unit 2<small>Senses</small></button>
        <button class="unit-tile" onclick="pickUnit(this,'3')">Unit 3<small>Fashion</small></button>
        <button class="unit-tile" onclick="pickUnit(this,'all')">All<small>Mixed</small></button>
      </div>
    </div>

    <button class="start-btn" id="start-btn" disabled onclick="startQuiz()">Start Quiz ‚Üí</button>
  </div>

  <!-- Sheets accordion -->
  <div class="acc" id="acc">
    <button class="acc-trigger" onclick="document.getElementById('acc').classList.toggle('open')">
      <span>‚öôÔ∏è &nbsp;Google Sheets setup <span style="font-size:12px;font-weight:400;color:var(--muted)">(teacher ‚Äî do once)</span></span>
      <svg class="chev" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg>
    </button>
    <div class="acc-body">

      <div class="step-row">
        <div class="step-num">1</div>
        <div class="step-txt">
          <strong>Create a Google Sheet</strong>
          Go to <a href="https://sheets.google.com" target="_blank">sheets.google.com</a>, create a blank spreadsheet and name it <b>Vocab Quiz Results</b>.
        </div>
      </div>

      <div class="step-row">
        <div class="step-num">2</div>
        <div class="step-txt">
          <strong>Open Apps Script</strong>
          In your sheet click <b>Extensions ‚Üí Apps Script</b>. Delete any existing code, paste the code below, then click <b>Save (üíæ)</b>.
<div class="code-block">function doPost(e) {
  var ss    = SpreadsheetApp.getActiveSpreadsheet();
  var sheet = ss.getSheets()[0];
  var data  = JSON.parse(e.postData.contents);

  if (sheet.getLastRow() === 0) {
    var h = ['Timestamp','Student','Unit','Score','Percent','Time',
             'Correct','Wrong','MC Def‚ÜíWord','MC Word‚ÜíDef',
             'True/False','Written','Words to Review'];
    sheet.appendRow(h);
    sheet.getRange(1,1,1,h.length)
         .setFontWeight('bold')
         .setBackground('#1c1814')
         .setFontColor('#ffffff');
    sheet.setFrozenRows(1);
  }

  sheet.appendRow([
    new Date().toLocaleString('en-GB'),
    data.student,
    data.unit,
    data.score + '/30',
    data.pct + '%',
    data.time,
    data.correct,
    data.wrong,
    data.types['MC: Def ‚Üí Word']  || '-',
    data.types['MC: Word ‚Üí Def']  || '-',
    data.types['True / False']    || '-',
    data.types['Written Answer']  || '-',
    data.missed.join(', ')        || 'none'
  ]);

  return ContentService
    .createTextOutput(JSON.stringify({status:'ok'}))
    .setMimeType(ContentService.MimeType.JSON);
}

function doGet() {
  return ContentService.createTextOutput('ready');
}</div>
        </div>
      </div>

      <div class="step-row">
        <div class="step-num">3</div>
        <div class="step-txt">
          <strong>Deploy as Web App</strong>
          Click <b>Deploy ‚Üí New deployment</b>. Set type to <b>Web app</b>. Set <b>Execute as: Me</b> and <b>Who has access: Anyone</b>. Click <b>Deploy</b>, authorise when prompted, then copy the <b>Web App URL</b>.
        </div>
      </div>

      <div class="step-row">
        <div class="step-num">4</div>
        <div class="step-txt">
          <strong>Paste your Web App URL below ‚Äî saved in the browser</strong>
          The URL is stored locally so students don't need to enter it; only you need to do this step once per device/browser.
          <div class="wh-row">
            <input class="wh-in" id="wh-in" type="text" placeholder="https://script.google.com/macros/s/‚Ä¶/exec">
            <button class="save-wh" onclick="saveWebhook()">Save ‚úì</button>
          </div>
          <div class="wh-ok" id="wh-ok">‚úì URL saved ‚Äî results will now sync automatically.</div>
        </div>
      </div>

      <div class="step-row">
        <div class="step-num">5</div>
        <div class="step-txt">
          <strong>Reading your results in Google Sheets</strong>
          Each row = one student session. Sort or filter the <b>Words to Review</b> column to instantly see which words the whole class keeps missing. You can also use <b>Data ‚Üí Create a filter</b> and filter by Unit to compare class performance per unit.
        </div>
      </div>

    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê QUIZ ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="screen" id="s-quiz">
  <div class="quiz-top">
    <div class="q-label">Question <strong id="qn">1</strong> / 30</div>
    <div class="chips">
      <div class="chip c">‚úì <span id="lc">0</span></div>
      <div class="chip w">‚úó <span id="lw">0</span></div>
    </div>
    <div class="tmr" id="tmr">00:00</div>
  </div>
  <div class="prog-track"><div class="prog-fill" id="prog"></div></div>
  <div id="qwrap"></div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê RESULTS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="screen" id="s-results">
  <div class="results-card">
    <p class="res-eye">Quiz Complete</p>
    <h2 class="res-headline" id="r-head">Well<br><em>Done!</em></h2>
    <p class="res-sub" id="r-sub"></p>
    <div class="score-row">
      <div class="score-n" id="r-score">0</div>
      <div class="score-d">/30</div>
    </div>
    <p class="score-pct" id="r-pct"></p>
    <div class="stat-row">
      <div class="stat-box"><div class="stat-v" id="r-c">0</div><div class="stat-l">Correct</div></div>
      <div class="stat-box"><div class="stat-v" id="r-w">0</div><div class="stat-l">Wrong</div></div>
      <div class="stat-box"><div class="stat-v" id="r-t">‚Äî</div><div class="stat-l">Time</div></div>
    </div>
    <p class="sep">Score by question type</p>
    <div class="type-rows" id="r-types"></div>
    <p class="sep">Words to review</p>
    <div class="hw-chips" id="r-hw"></div>
    <p class="sep">Results sync</p>
    <div class="sheets-badge" id="r-badge"></div>
    <button class="retry-btn" onclick="location.reload()">‚Ü∫ &nbsp;Try Again</button>
  </div>
</div>

</div>

<script>
// ‚îÄ‚îÄ DATA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const W = {
  1: [
    {w:"achieve",d:"to succeed in doing something after a lot of effort"},
    {w:"apply",d:"to officially ask for a job or a place at university"},
    {w:"beyond",d:"further than the usual limit or range"},
    {w:"break something down",d:"to divide something into smaller, easier parts"},
    {w:"career",d:"a job you train for and do for a long time"},
    {w:"clarify",d:"to explain something more clearly"},
    {w:"comfort zone",d:"a situation where you feel relaxed and safe"},
    {w:"compete",d:"to take part in a competition"},
    {w:"competence",d:"the ability to do something well"},
    {w:"conscious",d:"aware of and thinking about something"},
    {w:"degree",d:"a university qualification you get after completing a course"},
    {w:"earn",d:"to receive money for work you do"},
    {w:"fluency",d:"the ability to speak a language very well"},
    {w:"fluent",d:"able to speak a language very well"},
    {w:"frustrating",d:"making you feel annoyed because you cannot achieve something"},
    {w:"give up",d:"to stop trying because something is too difficult"},
    {w:"grade",d:"a letter or number showing the quality of a student's work"},
    {w:"improvement",d:"the process of becoming better than before"},
    {w:"incompetence",d:"lack of skill or ability to do something well"},
    {w:"maintain",d:"to make something stay the same"},
    {w:"measure",d:"to judge how good or bad something is"},
    {w:"mistake",d:"something you have done or said incorrectly"},
    {w:"motivated",d:"enthusiastic and determined to succeed"},
    {w:"period",d:"an amount of time during which something happens"},
    {w:"plateau",d:"a period when progress stops and things stop improving"},
    {w:"progress",d:"the process of developing or improving"},
    {w:"push yourself",d:"to try very hard to achieve something"},
    {w:"rarely",d:"not very often"},
    {w:"secure",d:"feeling confident and safe"},
    {w:"stage",d:"a particular part of a process that has several parts"},
    {w:"take risks",d:"to do things knowing something unpleasant could happen"},
    {w:"theory",d:"an idea that explains how or why something happens"},
    {w:"unconscious",d:"a feeling or thought you do not realise you have"},
    {w:"volunteer work",d:"work you do without being paid"},
  ],
  2: [
    {w:"ability",d:"the fact of being able to do something"},
    {w:"academic",d:"good at learning things by studying"},
    {w:"amygdala",d:"the part of the brain that processes emotions and memories"},
    {w:"associate with",d:"to form a connection in your mind between different things"},
    {w:"attitude",d:"your opinions or feelings about something"},
    {w:"bored",d:"feeling impatient because you are not interested in something"},
    {w:"childhood",d:"the time of your life when you are a child"},
    {w:"cognitive",d:"connected with recognising and understanding things"},
    {w:"cue",d:"something that tells someone indirectly what to do or expect"},
    {w:"danger",d:"a situation where harm or damage is possible"},
    {w:"dementia",d:"a serious illness where someone gradually loses their memory"},
    {w:"emotion",d:"a strong feeling such as love, fear or anger"},
    {w:"emotional",d:"relating to feelings and how they affect your life"},
    {w:"experiment",d:"a scientific test to find out what happens in certain conditions"},
    {w:"findings",d:"information you discover after doing research"},
    {w:"immediately",d:"without any delay"},
    {w:"implication",d:"a possible effect or result of something"},
    {w:"lifetime",d:"the period of time when someone is alive"},
    {w:"memory",d:"the ability to remember things"},
    {w:"memory loss",d:"when you cannot remember things"},
    {w:"olfactory cortex",d:"the part of the brain where our sense of smell is processed"},
    {w:"personality",d:"the part of a person that makes them behave in a particular way"},
    {w:"physiology",d:"the way that the body of a living thing operates"},
    {w:"recognise",d:"to know who or what something is because you have seen it before"},
    {w:"remind",d:"to make someone think of something because it is similar"},
    {w:"research",d:"detailed study to discover new facts"},
    {w:"response",d:"a reaction to something"},
    {w:"sense of smell",d:"the natural ability to smell things"},
    {w:"stimuli",d:"things that produce a reaction in a person or animal"},
    {w:"survival",d:"continuing to live, especially in difficult conditions"},
    {w:"think back",d:"to think about something that happened in the past"},
    {w:"transport",d:"to make you feel as if you are in a different place or time"},
    {w:"vivid",d:"producing very clear and detailed images in the mind"},
    {w:"youth",d:"the time in your life when you are young"},
  ],
  3: [
    {w:"accessories",d:"small things like jewellery you wear to give clothes more style"},
    {w:"advertise",d:"to tell people about a product to make them want to buy it"},
    {w:"beauty salon",d:"a shop where you get treatments for your skin, hair or nails"},
    {w:"blow",d:"to spend a lot of money quickly on things you do not need"},
    {w:"celebrity",d:"a famous person, especially in entertainment or sport"},
    {w:"choice",d:"the right or opportunity to choose between different things"},
    {w:"complaint",d:"a statement saying you are not satisfied with something"},
    {w:"credit card",d:"a card you use to buy things now and pay later"},
    {w:"department store",d:"a large shop divided into sections, each selling different things"},
    {w:"designer",d:"describing clothes made by a famous designer, usually expensive"},
    {w:"discount",d:"a reduction in the price of something"},
    {w:"exchange",d:"to give something in return for something else"},
    {w:"fashion",d:"styles of clothes and people's appearance"},
    {w:"fashion icon",d:"a famous person who is fashionable and people like to copy"},
    {w:"formal",d:"an important occasion where people wear special clothes"},
    {w:"groomed",d:"tidy and clean in your appearance"},
    {w:"image-conscious",d:"giving a lot of attention to the way you look"},
    {w:"influence",d:"the effect a person or thing has on someone's decisions"},
    {w:"inspiration",d:"something that gives you new ideas and enthusiasm"},
    {w:"jewellery",d:"objects like rings and necklaces worn as decoration"},
    {w:"keep up with",d:"to do or learn at the same speed as someone else"},
    {w:"lad",d:"a boy or a young man"},
    {w:"makeover",d:"changes made to make a person look much better"},
    {w:"market",d:"to use advertising to persuade people to buy something"},
    {w:"outfit",d:"a set of clothes worn together"},
    {w:"persuade",d:"to make someone agree to do something by giving reasons"},
    {w:"prom",d:"a formal dance for school students at the end of the year"},
    {w:"refund",d:"money you get back because you paid too much or returned something"},
    {w:"smarten up",d:"to make yourself look tidier and cleaner"},
    {w:"snowball",d:"to grow quickly and become very large"},
    {w:"suit",d:"a jacket and trousers or skirt made from the same cloth"},
    {w:"teenage",d:"between the ages of 13 and 19"},
    {w:"treatment",d:"a procedure at a beauty salon for your health or appearance"},
    {w:"tuxedo",d:"a man's black or white jacket worn on formal occasions"},
  ]
};

// ‚îÄ‚îÄ STATE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let student='', unit=null, webhook=localStorage.getItem('gquiz_wh')||'https://script.google.com/macros/s/AKfycbwV8OAoCx6Pa0pmF18efZqfhVIxefzs4JLYJ-GKhuXknlkVlMNMfmXLTwRw7Fwbzfyt/exec';
let qs=[], qi=0, correctN=0, wrongN=0, secs=0, ticker=null;
let missed=[];
const TYPES=['MC: Def ‚Üí Word','MC: Word ‚Üí Def','True / False','Written Answer'];
let tStats={};

window.addEventListener('DOMContentLoaded',()=>{
  if(webhook){ const e=document.getElementById('wh-in'); if(e) e.value=webhook; document.getElementById('wh-ok').style.display='block'; }
});
document.getElementById('sname').addEventListener('input',checkReady);

function pickUnit(el,u){
  unit=u;
  document.querySelectorAll('.unit-tile').forEach(b=>b.classList.remove('on'));
  el.classList.add('on');
  checkReady();
}
function checkReady(){
  document.getElementById('start-btn').disabled=!(document.getElementById('sname').value.trim()&&unit);
}
function saveWebhook(){
  const v=document.getElementById('wh-in').value.trim();
  if(!v) return;
  webhook=v; localStorage.setItem('gquiz_wh',v);
  document.getElementById('wh-ok').style.display='block';
}

// ‚îÄ‚îÄ HELPERS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const shuf=a=>{const r=[...a];for(let i=r.length-1;i>0;i--){const j=0|Math.random()*(i+1);[r[i],r[j]]=[r[j],r[i]];}return r;};
const allW=()=>[...W[1],...W[2],...W[3]];
const poolW=()=>unit==='all'?allW():[...W[parseInt(unit)]];
const unitOf=word=>{for(const u of[1,2,3]) if(W[u].find(x=>x.w===word.w)) return u; return '?';};
function distractors(correct,field,n=3){
  return shuf(allW().filter(w=>w[field]!==correct[field])).slice(0,n).map(w=>w[field]);
}
const esc=s=>(s||'').replace(/\\/g,'\\\\').replace(/'/g,"\\'");
const fmt=s=>s.replace(/\n/g,'');

function buildQuiz(){
  const p=shuf(poolW()).slice(0,30);
  const dist=shuf([
    ...Array(10).fill('mc-dw'),
    ...Array(10).fill('mc-wd'),
    ...Array(5).fill('tf'),
    ...Array(5).fill('written'),
  ]);
  TYPES.forEach(t=>{ tStats[t]=[0,0]; });
  return p.map((word,i)=>({word,type:dist[i]}));
}

// ‚îÄ‚îÄ RENDER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderQ(){
  const{word,type}=qs[qi];
  document.getElementById('qn').textContent=qi+1;
  document.getElementById('prog').style.width=(qi/30*100)+'%';

  const bLabel={'mc-dw':'Multiple Choice','mc-wd':'Multiple Choice','tf':'True / False','written':'Written Answer'};
  const bDot={'mc-dw':'#1a4a8a','mc-wd':'#1a4a8a','tf':'#c0390a','written':'#1f6b48'};

  let h=`<div class="q-card">`;
  h+=`<div class="q-unit">Unit ${unitOf(word)}</div>`;
  h+=`<div class="q-badge"><span class="q-badge-dot" style="background:${bDot[type]}"></span>${bLabel[type]}</div>`;

  if(type==='mc-dw'){
    const opts=shuf([word.w,...distractors(word,'w')]);
    const ci=opts.indexOf(word.w);
    h+=`<div class="q-stem"><span class="def">"${fmt(word.d)}"</span><span class="hint">Which word matches this definition?</span></div>`;
    h+=`<div class="mc-grid">`;
    opts.forEach((o,i)=>{ h+=`<button class="mc-opt" id="o${i}" onclick="answerMC(${i},${ci},'MC: Def \u2192 Word','${esc(word.w)}')"><span class="key">${'ABCD'[i]}</span>${o}</button>`; });
    h+=`</div>`;
  } else if(type==='mc-wd'){
    const opts=shuf([word.d,...distractors(word,'d')]);
    const ci=opts.indexOf(word.d);
    h+=`<div class="q-stem">What does <em>${word.w}</em> mean?</div>`;
    h+=`<div class="mc-grid">`;
    opts.forEach((o,i)=>{ h+=`<button class="mc-opt" id="o${i}" onclick="answerMC(${i},${ci},'MC: Word \u2192 Def','${esc(word.w)}')"><span class="key">${'ABCD'[i]}</span>${fmt(o)}</button>`; });
    h+=`</div>`;
  } else if(type==='tf'){
    const isTrue=Math.random()>.5;
    const shownDef=isTrue?word.d:shuf(allW().filter(x=>x.w!==word.w))[0].d;
    const ans=isTrue?'True':'False';
    h+=`<div class="q-stem"><em>${word.w}</em> means:<br><span class="def">"${fmt(shownDef)}"</span></div>`;
    h+=`<div class="tf-grid">`;
    ['True','False'].forEach(v=>{ h+=`<button class="tf-btn" id="tf${v}" onclick="answerTF('${v}','${ans}','${esc(word.w)}')">${v}</button>`; });
    h+=`</div>`;
  } else {
    h+=`<div class="q-stem"><span class="def">"${fmt(word.d)}"</span><span class="hint">Type the word or phrase.</span></div>`;
    h+=`<div class="written-col"><input class="written-in" id="win" type="text" placeholder="Your answer‚Ä¶" autocomplete="off" onkeydown="if(event.key==='Enter')checkWritten('${esc(word.w)}')"><button class="check-btn" id="chkbtn" onclick="checkWritten('${esc(word.w)}')">Check ‚Üí</button></div>`;
  }
  h+=`<div class="fb" id="fb"></div></div>`;
  document.getElementById('qwrap').innerHTML=h;
  if(type==='written') setTimeout(()=>{ const e=document.getElementById('win'); if(e) e.focus(); },80);
}

// ‚îÄ‚îÄ ANSWERS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function record(ok,type,word){
  tStats[type][1]++;
  if(ok){ correctN++; tStats[type][0]++; document.getElementById('lc').textContent=correctN; }
  else  { wrongN++;                       document.getElementById('lw').textContent=wrongN;
    if(!missed.includes(word)) missed.push(word); }
}
function showFB(ok,ans){
  const fb=document.getElementById('fb'); if(!fb) return;
  fb.className=`fb show ${ok?'ok':'no'}`;
  fb.innerHTML=ok?'‚úì Correct!':`‚úó Incorrect. <span class="fb-ans">Answer: <b>${ans}</b></span>`;
}
function answerMC(chosen,ci,type,word){
  record(chosen===ci,type,word);
  for(let i=0;i<4;i++){ const b=document.getElementById(`o${i}`); if(!b) continue; b.disabled=true;
    if(i===ci) b.classList.add('correct'); else if(i===chosen&&chosen!==ci) b.classList.add('wrong'); else b.classList.add('dim'); }
  showFB(chosen===ci,qs[qi].word.w);
  setTimeout(advance,1500);
}
function answerTF(chosen,ans,word){
  const ok=chosen===ans; record(ok,'True / False',word);
  ['True','False'].forEach(v=>{ const b=document.getElementById(`tf${v}`); if(!b) return; b.disabled=true;
    if(v===ans) b.classList.add('correct'); else if(v===chosen&&!ok) b.classList.add('wrong'); });
  showFB(ok,word); setTimeout(advance,1700);
}
function checkWritten(correctWord){
  const inp=document.getElementById('win'),btn=document.getElementById('chkbtn');
  if(!inp||inp.disabled) return;
  const val=inp.value.trim().toLowerCase(), cor=correctWord.toLowerCase();
  const ok=val===cor||val.replace(/-/g,' ')===cor.replace(/-/g,' ');
  inp.disabled=btn.disabled=true; inp.classList.add(ok?'correct':'wrong');
  record(ok,'Written Answer',correctWord); showFB(ok,correctWord); setTimeout(advance,1900);
}
function advance(){ qi++; qi>=30||qi>=qs.length ? finish() : renderQ(); }

// ‚îÄ‚îÄ START / FINISH ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function startQuiz(){
  student=document.getElementById('sname').value.trim();
  correctN=0; wrongN=0; secs=0; qi=0; missed=[];
  TYPES.forEach(t=>{ tStats[t]=[0,0]; });
  document.getElementById('lc').textContent='0';
  document.getElementById('lw').textContent='0';
  qs=buildQuiz();
  show('s-quiz'); renderQ();
  ticker=setInterval(()=>{
    secs++;
    document.getElementById('tmr').textContent=
      String(Math.floor(secs/60)).padStart(2,'0')+':'+String(secs%60).padStart(2,'0');
  },1000);
}

function finish(){
  clearInterval(ticker);
  document.getElementById('prog').style.width='100%';
  const pct=Math.round(correctN/30*100);
  const timeStr=String(Math.floor(secs/60)).padStart(2,'0')+':'+String(secs%60).padStart(2,'0');
  const uLabel=unit==='all'?'All Units (Mixed)':`Unit ${unit}`;

  const[h1,h2]=pct>=90?['Out','<em>standing!</em>']:pct>=75?['Well','<em>Done!</em>']:
                pct>=55?['Good','<em>Effort!</em>']:pct>=40?['Keep','<em>Going!</em>']:
                ['Review the','<em>Wordlist!</em>'];
  document.getElementById('r-head').innerHTML=h1+'<br>'+h2;
  document.getElementById('r-sub').textContent=student+' ¬∑ '+uLabel;
  document.getElementById('r-score').textContent=correctN;
  document.getElementById('r-pct').textContent=`${pct}% ‚Äî ${correctN} correct out of 30`;
  document.getElementById('r-c').textContent=correctN;
  document.getElementById('r-w').textContent=wrongN;
  document.getElementById('r-t').textContent=timeStr;

  const tb=document.getElementById('r-types'); tb.innerHTML='';
  TYPES.forEach(t=>{ const[c,tot]=tStats[t]; if(!tot) return;
    const p=Math.round(c/tot*100);
    tb.innerHTML+=`<div class="type-row"><div class="type-name">${t}</div><div class="type-track"><div class="type-bar" style="width:${p}%"></div></div><div class="type-num">${c}/${tot}</div></div>`;
  });

  const hw=document.getElementById('r-hw');
  hw.innerHTML=missed.length
    ?missed.map(w=>`<span class="hw-chip">${w}</span>`).join('')
    :`<span class="hw-none">‚úì Perfect ‚Äî no words missed!</span>`;

  show('s-results');
  pushSheets(pct,timeStr,uLabel);
}

// ‚îÄ‚îÄ GOOGLE SHEETS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function pushSheets(pct,timeStr,uLabel){
  const badge=document.getElementById('r-badge');
  if(!webhook){
    badge.className='sheets-badge fail';
    badge.innerHTML='‚ö† No webhook URL saved. Open the ‚öô setup panel above to add one.';
    return;
  }
  badge.className='sheets-badge sending';
  badge.innerHTML='‚è≥ Sending to Google Sheets‚Ä¶';

  const types={};
  TYPES.forEach(t=>{ const[c,tot]=tStats[t]; if(tot) types[t]=`${c}/${tot}`; });

  fetch(webhook,{
    method:'POST', mode:'no-cors',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({student,unit:uLabel,score:correctN,pct,time:timeStr,correct:correctN,wrong:wrongN,types,missed})
  })
  .then(()=>{ badge.className='sheets-badge ok'; badge.innerHTML='‚úì Results saved to Google Sheets!'; })
  .catch(()=>{ badge.className='sheets-badge fail'; badge.innerHTML='‚úó Could not reach Google Sheets. Check your webhook URL.'; });
}

function show(id){
  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  window.scrollTo(0,0);
}
</script>
</body>
</html>
