<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Global Edu — Vocabulary Quiz</title>
<link href="https://fonts.googleapis.com/css2?family=Fraunces:ital,wght@0,400;0,700;0,900;1,400&family=Plus+Jakarta+Sans:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #f7f4ef;
  --surface: #ffffff;
  --card: #fdfcfa;
  --ink: #1a1814;
  --ink2: #4a4640;
  --muted: #9a938a;
  --border: #e8e2d9;
  --accent: #c8410a;
  --accent2: #2a6b4a;
  --accent3: #1e4a8a;
  --yellow: #f0c030;
  --correct: #2a6b4a;
  --wrong: #c8410a;
  --correct-bg: #edf7f2;
  --wrong-bg: #fdf0ec;
  --shadow: 0 2px 16px rgba(26,24,20,0.08);
  --shadow-lg: 0 8px 40px rgba(26,24,20,0.14);
  --radius: 12px;
}

* { box-sizing: border-box; margin: 0; padding: 0; }

body {
  background: var(--bg);
  color: var(--ink);
  font-family: 'Plus Jakarta Sans', sans-serif;
  font-weight: 400;
  min-height: 100vh;
  line-height: 1.5;
}

/* Subtle dot pattern background */
body::before {
  content: '';
  position: fixed; inset: 0;
  background-image: radial-gradient(circle, #c8b89a22 1px, transparent 1px);
  background-size: 28px 28px;
  pointer-events: none;
  z-index: 0;
}

.wrap {
  position: relative;
  z-index: 1;
  max-width: 740px;
  margin: 0 auto;
  padding: 0 20px 60px;
}

/* ── SCREEN SYSTEM ── */
.screen { display: none; }
.screen.active { display: block; }

/* ── SETUP PANEL ── */
.setup-panel {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 20px;
  padding: 52px 48px;
  margin-top: 48px;
  box-shadow: var(--shadow-lg);
}

.brand {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 36px;
}
.brand-dot {
  width: 36px; height: 36px;
  background: var(--accent);
  border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
}
.brand-dot svg { width: 18px; height: 18px; fill: white; }
.brand-name {
  font-family: 'Fraunces', serif;
  font-size: 18px;
  font-weight: 700;
  color: var(--ink);
  letter-spacing: -0.3px;
}

.setup-title {
  font-family: 'Fraunces', serif;
  font-size: 42px;
  font-weight: 900;
  line-height: 1.05;
  letter-spacing: -1.5px;
  color: var(--ink);
  margin-bottom: 10px;
}
.setup-title em { font-style: italic; color: var(--accent); }

.setup-sub {
  color: var(--muted);
  font-size: 15px;
  margin-bottom: 40px;
}

.form-group { margin-bottom: 24px; }
.form-label {
  display: block;
  font-size: 12px;
  font-weight: 600;
  letter-spacing: 1.5px;
  text-transform: uppercase;
  color: var(--muted);
  margin-bottom: 8px;
}

.form-input {
  width: 100%;
  padding: 14px 18px;
  border: 1.5px solid var(--border);
  border-radius: var(--radius);
  font-family: 'Plus Jakarta Sans', sans-serif;
  font-size: 16px;
  color: var(--ink);
  background: var(--card);
  transition: border-color 0.2s, box-shadow 0.2s;
  outline: none;
}
.form-input:focus {
  border-color: var(--accent);
  box-shadow: 0 0 0 3px rgba(200,65,10,0.1);
}

.unit-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 10px;
}

.unit-btn {
  padding: 14px 10px;
  border: 1.5px solid var(--border);
  border-radius: var(--radius);
  background: var(--card);
  font-family: 'Plus Jakarta Sans', sans-serif;
  font-size: 13px;
  font-weight: 600;
  color: var(--ink2);
  cursor: pointer;
  transition: all 0.15s;
  text-align: center;
}
.unit-btn:hover { border-color: var(--accent); color: var(--accent); background: #fdf5f2; }
.unit-btn.selected {
  border-color: var(--accent);
  background: var(--accent);
  color: white;
}

.start-btn {
  width: 100%;
  padding: 18px;
  background: var(--ink);
  color: white;
  border: none;
  border-radius: var(--radius);
  font-family: 'Plus Jakarta Sans', sans-serif;
  font-size: 16px;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.2s;
  margin-top: 12px;
  letter-spacing: 0.3px;
}
.start-btn:hover { background: var(--accent); transform: translateY(-1px); box-shadow: var(--shadow); }
.start-btn:disabled { background: var(--muted); cursor: not-allowed; transform: none; }

/* ── QUIZ HEADER ── */
.quiz-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 24px 0 0;
  margin-bottom: 28px;
  flex-wrap: wrap;
  gap: 12px;
}

.q-counter {
  font-family: 'JetBrains Mono', monospace;
  font-size: 13px;
  color: var(--muted);
  font-weight: 500;
}
.q-counter strong { color: var(--ink); font-weight: 700; }

.q-score-live {
  display: flex;
  gap: 16px;
}
.score-chip {
  display: flex;
  align-items: center;
  gap: 6px;
  font-family: 'JetBrains Mono', monospace;
  font-size: 13px;
  font-weight: 500;
  padding: 5px 12px;
  border-radius: 99px;
  border: 1.5px solid var(--border);
  background: var(--surface);
}
.score-chip.correct-chip { border-color: var(--correct); color: var(--correct); background: var(--correct-bg); }
.score-chip.wrong-chip   { border-color: var(--wrong);   color: var(--wrong);   background: var(--wrong-bg); }

.timer-display {
  font-family: 'JetBrains Mono', monospace;
  font-size: 13px;
  color: var(--muted);
  font-weight: 500;
}

/* Progress bar */
.progress-track {
  height: 4px;
  background: var(--border);
  border-radius: 99px;
  overflow: hidden;
  margin-bottom: 28px;
}
.progress-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--accent), var(--accent2));
  border-radius: 99px;
  transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
}

/* ── QUESTION CARD ── */
.q-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 20px;
  padding: 36px 40px;
  box-shadow: var(--shadow);
  animation: fadeSlide 0.3s ease;
}
@keyframes fadeSlide {
  from { opacity: 0; transform: translateY(12px); }
  to   { opacity: 1; transform: translateY(0); }
}

.q-type-badge {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  font-size: 11px;
  font-weight: 600;
  letter-spacing: 1.5px;
  text-transform: uppercase;
  color: var(--muted);
  margin-bottom: 20px;
  padding: 4px 10px;
  border: 1px solid var(--border);
  border-radius: 99px;
}
.q-type-badge .dot {
  width: 6px; height: 6px;
  border-radius: 50%;
  background: var(--accent);
}

.q-text {
  font-family: 'Fraunces', serif;
  font-size: 26px;
  font-weight: 700;
  line-height: 1.3;
  color: var(--ink);
  margin-bottom: 28px;
  letter-spacing: -0.5px;
}
.q-text .word-highlight {
  color: var(--accent);
  font-style: italic;
}
.q-text .def-text {
  font-size: 22px;
  font-weight: 400;
  font-style: italic;
  color: var(--ink2);
}
.q-unit-tag {
  font-size: 11px;
  color: var(--muted);
  font-family: 'JetBrains Mono', monospace;
  margin-bottom: 8px;
  font-weight: 500;
}

/* Multiple choice options */
.mc-options {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 10px;
}
@media (max-width: 540px) { .mc-options { grid-template-columns: 1fr; } }

.mc-opt {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 14px 18px;
  border: 1.5px solid var(--border);
  border-radius: var(--radius);
  background: var(--card);
  cursor: pointer;
  transition: all 0.15s;
  text-align: left;
  font-family: 'Plus Jakarta Sans', sans-serif;
  font-size: 15px;
  color: var(--ink);
  font-weight: 500;
}
.mc-opt:hover:not(:disabled) { border-color: var(--accent3); background: #f0f5ff; }
.mc-opt .opt-key {
  width: 28px; height: 28px;
  flex-shrink: 0;
  background: var(--border);
  border-radius: 6px;
  display: flex; align-items: center; justify-content: center;
  font-family: 'JetBrains Mono', monospace;
  font-size: 12px;
  font-weight: 700;
  color: var(--muted);
  transition: all 0.15s;
}
.mc-opt:hover:not(:disabled) .opt-key { background: var(--accent3); color: white; }
.mc-opt.correct { border-color: var(--correct); background: var(--correct-bg); color: var(--correct); }
.mc-opt.correct .opt-key { background: var(--correct); color: white; }
.mc-opt.wrong   { border-color: var(--wrong);   background: var(--wrong-bg);   color: var(--wrong); }
.mc-opt.wrong .opt-key   { background: var(--wrong);   color: white; }
.mc-opt.dim { opacity: 0.35; }
.mc-opt:disabled { cursor: default; }

/* True/False */
.tf-options {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
}
.tf-btn {
  padding: 20px;
  border: 1.5px solid var(--border);
  border-radius: var(--radius);
  background: var(--card);
  cursor: pointer;
  font-family: 'Fraunces', serif;
  font-size: 22px;
  font-weight: 700;
  transition: all 0.15s;
  text-align: center;
}
.tf-btn:hover:not(:disabled) { border-color: var(--accent3); background: #f0f5ff; transform: translateY(-2px); }
.tf-btn.correct { border-color: var(--correct); background: var(--correct-bg); color: var(--correct); }
.tf-btn.wrong   { border-color: var(--wrong);   background: var(--wrong-bg);   color: var(--wrong); }
.tf-btn:disabled { cursor: default; }

/* Written answer */
.written-wrap { display: flex; flex-direction: column; gap: 12px; }
.written-input {
  width: 100%;
  padding: 16px 20px;
  border: 1.5px solid var(--border);
  border-radius: var(--radius);
  font-family: 'Plus Jakarta Sans', sans-serif;
  font-size: 18px;
  font-weight: 500;
  color: var(--ink);
  background: var(--card);
  outline: none;
  transition: border-color 0.2s, box-shadow 0.2s;
}
.written-input:focus { border-color: var(--accent3); box-shadow: 0 0 0 3px rgba(30,74,138,0.1); }
.written-input.correct { border-color: var(--correct); background: var(--correct-bg); color: var(--correct); }
.written-input.wrong   { border-color: var(--wrong);   background: var(--wrong-bg);   color: var(--wrong); }

.submit-btn {
  padding: 14px 32px;
  background: var(--accent3);
  color: white;
  border: none;
  border-radius: var(--radius);
  font-family: 'Plus Jakarta Sans', sans-serif;
  font-size: 15px;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.15s;
  align-self: flex-start;
}
.submit-btn:hover { background: var(--ink); transform: translateY(-1px); }

/* Feedback row */
.feedback-row {
  display: none;
  margin-top: 18px;
  padding: 14px 18px;
  border-radius: var(--radius);
  font-size: 14px;
  font-weight: 600;
  align-items: center;
  gap: 10px;
}
.feedback-row.show { display: flex; }
.feedback-row.correct-fb { background: var(--correct-bg); color: var(--correct); border: 1px solid #b8e8cf; }
.feedback-row.wrong-fb   { background: var(--wrong-bg);   color: var(--wrong);   border: 1px solid #f0c4b4; }
.feedback-row .fb-answer { font-weight: 400; color: var(--ink2); margin-left: 4px; }
.feedback-row .fb-answer strong { color: var(--ink); }

/* ── RESULTS ── */
.results-panel {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 20px;
  padding: 48px;
  margin-top: 40px;
  box-shadow: var(--shadow-lg);
}
.results-title {
  font-family: 'Fraunces', serif;
  font-size: 48px;
  font-weight: 900;
  letter-spacing: -2px;
  line-height: 1;
  margin-bottom: 6px;
}
.results-title em { font-style: italic; color: var(--accent); }

.score-big-wrap {
  display: flex;
  align-items: baseline;
  gap: 8px;
  margin: 28px 0 8px;
}
.score-big {
  font-family: 'Fraunces', serif;
  font-size: 80px;
  font-weight: 900;
  color: var(--accent);
  line-height: 1;
  letter-spacing: -3px;
}
.score-denom { font-family: 'Fraunces', serif; font-size: 36px; color: var(--muted); }
.score-pct {
  font-size: 15px;
  color: var(--muted);
  margin-bottom: 32px;
}

.stats-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 12px;
  margin-bottom: 32px;
}
.stat-box {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 18px;
  text-align: center;
}
.stat-box-val {
  font-family: 'Fraunces', serif;
  font-size: 28px;
  font-weight: 900;
  color: var(--ink);
}
.stat-box-label { font-size: 11px; color: var(--muted); text-transform: uppercase; letter-spacing: 1px; margin-top: 4px; }

.section-heading {
  font-size: 12px;
  font-weight: 700;
  letter-spacing: 2px;
  text-transform: uppercase;
  color: var(--muted);
  margin: 28px 0 14px;
  padding-bottom: 8px;
  border-bottom: 1px solid var(--border);
}

/* Hard words list */
.hard-words-list {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin-bottom: 28px;
}
.hard-word-chip {
  padding: 6px 14px;
  background: var(--wrong-bg);
  border: 1px solid #f0c4b4;
  border-radius: 99px;
  font-size: 13px;
  font-weight: 600;
  color: var(--wrong);
}
.none-msg { font-size: 14px; color: var(--correct); font-weight: 500; }

/* Type breakdown */
.type-breakdown { display: flex; flex-direction: column; gap: 8px; margin-bottom: 28px; }
.type-row {
  display: flex;
  align-items: center;
  gap: 12px;
  font-size: 13px;
}
.type-label { width: 200px; color: var(--ink2); font-weight: 500; flex-shrink: 0; }
.type-bar-wrap { flex: 1; height: 8px; background: var(--border); border-radius: 99px; overflow: hidden; }
.type-bar-fill { height: 100%; border-radius: 99px; background: var(--accent2); transition: width 1s ease; }
.type-stat { width: 48px; text-align: right; font-family: 'JetBrains Mono', monospace; font-size: 12px; color: var(--muted); }

/* Sheets status */
.sheets-status {
  padding: 14px 18px;
  border-radius: var(--radius);
  font-size: 13px;
  font-weight: 600;
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 20px;
}
.sheets-status.sending { background: #fff8e6; border: 1px solid #f0c030; color: #8a6000; }
.sheets-status.sent    { background: var(--correct-bg); border: 1px solid #b8e8cf; color: var(--correct); }
.sheets-status.failed  { background: var(--wrong-bg); border: 1px solid #f0c4b4; color: var(--wrong); }

.retry-btn {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 14px 28px;
  background: var(--ink);
  color: white;
  border: none;
  border-radius: var(--radius);
  font-family: 'Plus Jakarta Sans', sans-serif;
  font-size: 15px;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.15s;
  margin-top: 8px;
}
.retry-btn:hover { background: var(--accent); transform: translateY(-1px); }

/* ── SETUP INSTRUCTIONS ── */
.setup-instructions {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 20px;
  padding: 40px 48px;
  margin-top: 32px;
  box-shadow: var(--shadow);
}
.setup-instructions summary {
  font-family: 'Fraunces', serif;
  font-size: 20px;
  font-weight: 700;
  cursor: pointer;
  color: var(--ink);
  display: flex;
  align-items: center;
  gap: 10px;
  user-select: none;
}
.setup-instructions summary::marker { content: ''; }
.setup-instructions[open] summary::before { content: '▾ '; }
.setup-instructions:not([open]) summary::before { content: '▸ '; }
.setup-step {
  display: flex;
  gap: 14px;
  margin-top: 20px;
  padding: 16px;
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
}
.step-num {
  width: 28px; height: 28px;
  background: var(--accent);
  color: white;
  border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  font-size: 12px;
  font-weight: 700;
  flex-shrink: 0;
}
.step-body { font-size: 14px; color: var(--ink2); line-height: 1.6; }
.step-body strong { color: var(--ink); display: block; margin-bottom: 4px; }
.code-block {
  background: var(--ink);
  color: #a8e6c0;
  padding: 14px 18px;
  border-radius: 8px;
  font-family: 'JetBrains Mono', monospace;
  font-size: 11px;
  line-height: 1.7;
  margin-top: 10px;
  white-space: pre-wrap;
  word-break: break-all;
  overflow-x: auto;
}
.webhook-input-wrap { display: flex; gap: 10px; margin-top: 12px; flex-wrap: wrap; }
.webhook-input {
  flex: 1;
  padding: 10px 14px;
  border: 1.5px solid var(--border);
  border-radius: 8px;
  font-family: 'JetBrains Mono', monospace;
  font-size: 12px;
  color: var(--ink);
  outline: none;
  min-width: 200px;
}
.webhook-input:focus { border-color: var(--accent); }
.save-webhook-btn {
  padding: 10px 20px;
  background: var(--accent2);
  color: white;
  border: none;
  border-radius: 8px;
  font-size: 13px;
  font-weight: 700;
  cursor: pointer;
  white-space: nowrap;
}
.save-webhook-btn:hover { opacity: 0.9; }

@media (max-width: 600px) {
  .setup-panel, .results-panel, .setup-instructions { padding: 28px 24px; }
  .q-card { padding: 24px 20px; }
  .setup-title { font-size: 32px; }
  .unit-grid { grid-template-columns: repeat(2,1fr); }
  .stats-grid { grid-template-columns: repeat(2,1fr); }
  .mc-options { grid-template-columns: 1fr; }
  .tf-options { grid-template-columns: 1fr; }
  .score-big { font-size: 60px; }
}
</style>
</head>
<body>
<div class="wrap">

<!-- ══════════════════════════════════════ -->
<!-- SCREEN 1: SETUP -->
<!-- ══════════════════════════════════════ -->
<div class="screen active" id="screen-setup">
  <div class="setup-panel">
    <div class="brand">
      <div class="brand-dot">
        <svg viewBox="0 0 24 24"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg>
      </div>
      <span class="brand-name">Global Edu</span>
    </div>

    <h1 class="setup-title">Vocabulary<br><em>Quiz</em></h1>
    <p class="setup-sub">Intermediate · Units 1, 2 & 3 · 30 questions per session</p>

    <div class="form-group">
      <label class="form-label" for="student-name">Your name</label>
      <input class="form-input" id="student-name" type="text" placeholder="e.g. Sunnat Xayrullayev" autocomplete="off">
    </div>

    <div class="form-group">
      <label class="form-label">Choose unit</label>
      <div class="unit-grid">
        <button class="unit-btn" onclick="selectUnit('1')">Unit 1<br><small style="font-weight:400;font-size:11px;opacity:.7">Learning</small></button>
        <button class="unit-btn" onclick="selectUnit('2')">Unit 2<br><small style="font-weight:400;font-size:11px;opacity:.7">Senses</small></button>
        <button class="unit-btn" onclick="selectUnit('3')">Unit 3<br><small style="font-weight:400;font-size:11px;opacity:.7">Fashion</small></button>
        <button class="unit-btn" onclick="selectUnit('all')">All<br><small style="font-weight:400;font-size:11px;opacity:.7">Mixed</small></button>
      </div>
    </div>

    <button class="start-btn" id="start-btn" onclick="startQuiz()" disabled>Start Quiz →</button>
  </div>

  <!-- Google Sheets Setup Instructions -->
  <details class="setup-instructions" id="setup-details">
    <summary>⚙ Google Sheets Setup (teacher only — do once)</summary>

    <div class="setup-step">
      <div class="step-num">1</div>
      <div class="step-body">
        <strong>Create a new Google Sheet</strong>
        Go to <a href="https://sheets.google.com" target="_blank" style="color:var(--accent)">sheets.google.com</a> and create a blank spreadsheet. Name it "Vocab Quiz Results".
      </div>
    </div>

    <div class="setup-step">
      <div class="step-num">2</div>
      <div class="step-body">
        <strong>Open Apps Script</strong>
        In your sheet, click <b>Extensions → Apps Script</b>. Delete any existing code and paste this:
        <div class="code-block">function doPost(e) {
  var sheet = SpreadsheetApp.getActiveSpreadsheet().getSheets()[0];
  var data = JSON.parse(e.postData.contents);

  // Add header row if empty
  if (sheet.getLastRow() === 0) {
    sheet.appendRow([
      'Timestamp','Student','Unit','Score','Percent',
      'Time (sec)','Correct','Wrong','MC Def→Word',
      'MC Word→Def','True/False','Written','Hard Words'
    ]);
    sheet.getRange(1,1,1,13).setFontWeight('bold')
         .setBackground('#1a1814').setFontColor('#ffffff');
  }

  sheet.appendRow([
    new Date().toLocaleString(),
    data.student,
    data.unit,
    data.score + '/' + data.total,
    data.percent + '%',
    data.timeSec,
    data.correct,
    data.wrong,
    data.byType['MC: Def → Word'] || '—',
    data.byType['MC: Word → Def'] || '—',
    data.byType['True / False']   || '—',
    data.byType['Written Answer'] || '—',
    data.hardWords.join(', ')
  ]);

  return ContentService
    .createTextOutput(JSON.stringify({status:'ok'}))
    .setMimeType(ContentService.MimeType.JSON);
}

function doGet(e) {
  return ContentService.createTextOutput('ok');
}</div>
      </div>
    </div>

    <div class="setup-step">
      <div class="step-num">3</div>
      <div class="step-body">
        <strong>Deploy as Web App</strong>
        Click <b>Deploy → New Deployment</b>. Set type to <b>Web app</b>. Set "Execute as" to <b>Me</b> and "Who has access" to <b>Anyone</b>. Click Deploy and copy the URL.
      </div>
    </div>

    <div class="setup-step">
      <div class="step-num">4</div>
      <div class="step-body">
        <strong>Paste your Web App URL below</strong>
        <div class="webhook-input-wrap">
          <input class="webhook-input" id="webhook-url" type="text" placeholder="https://script.google.com/macros/s/YOUR_ID/exec">
          <button class="save-webhook-btn" onclick="saveWebhook()">Save URL ✓</button>
        </div>
        <div id="webhook-saved" style="font-size:13px;color:var(--correct);margin-top:8px;display:none;">✓ URL saved! Results will now sync to your sheet.</div>
      </div>
    </div>
  </details>
</div>

<!-- ══════════════════════════════════════ -->
<!-- SCREEN 2: QUIZ -->
<!-- ══════════════════════════════════════ -->
<div class="screen" id="screen-quiz">
  <div class="quiz-header">
    <div class="q-counter">Question <strong id="q-num">1</strong> of 30</div>
    <div class="q-score-live">
      <div class="score-chip correct-chip">✓ <span id="live-correct">0</span></div>
      <div class="score-chip wrong-chip">✗ <span id="live-wrong">0</span></div>
    </div>
    <div class="timer-display" id="timer-disp">00:00</div>
  </div>
  <div class="progress-track">
    <div class="progress-fill" id="progress-bar" style="width:0%"></div>
  </div>
  <div id="q-card-wrap"></div>
</div>

<!-- ══════════════════════════════════════ -->
<!-- SCREEN 3: RESULTS -->
<!-- ══════════════════════════════════════ -->
<div class="screen" id="screen-results">
  <div class="results-panel">
    <p style="font-size:12px;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:var(--muted);margin-bottom:8px;">Quiz Complete</p>
    <h2 class="results-title" id="results-title">Great<br><em>Work!</em></h2>
    <p style="font-size:15px;color:var(--muted);margin-top:8px;" id="student-result-name"></p>

    <div class="score-big-wrap">
      <div class="score-big" id="res-score">0</div>
      <div class="score-denom">/30</div>
    </div>
    <p class="score-pct" id="res-pct"></p>

    <div class="stats-grid">
      <div class="stat-box">
        <div class="stat-box-val" id="res-correct">0</div>
        <div class="stat-box-label">Correct</div>
      </div>
      <div class="stat-box">
        <div class="stat-box-val" id="res-wrong">0</div>
        <div class="stat-box-label">Wrong</div>
      </div>
      <div class="stat-box">
        <div class="stat-box-val" id="res-time">—</div>
        <div class="stat-box-label">Time</div>
      </div>
    </div>

    <!-- By question type -->
    <div class="section-heading">Score by question type</div>
    <div class="type-breakdown" id="type-breakdown"></div>

    <!-- Hard words -->
    <div class="section-heading">Words to review</div>
    <div class="hard-words-list" id="hard-words-list"></div>

    <!-- Sheets status -->
    <div class="sheets-status sending" id="sheets-status" style="display:none">
      <span>⏳</span> Sending results to Google Sheets…
    </div>

    <button class="retry-btn" onclick="location.reload()">↺ &nbsp; Try Again</button>
  </div>
</div>

</div><!-- /wrap -->

<script>
// ═══════════════════════════════════════════════════
// WORD DATA — Unit 1, 2, 3
// ═══════════════════════════════════════════════════
const WORDS = {
  1: [
    {w:"achieve",d:"to succeed in doing something after a lot of effort"},
    {w:"apply",d:"to officially ask for a job or place at university"},
    {w:"beyond",d:"further than the usual range or limit"},
    {w:"career",d:"a job you have been trained for and do for a long time"},
    {w:"clarify",d:"to explain something more clearly"},
    {w:"comfort zone",d:"a situation where you feel relaxed and safe"},
    {w:"compete",d:"to take part in a competition or sports event"},
    {w:"competence",d:"the ability to do something well"},
    {w:"conscious",d:"aware of and thinking about something"},
    {w:"degree",d:"a university qualification you get after completing a course"},
    {w:"earn",d:"to receive money for work that you do"},
    {w:"fluency",d:"the ability to speak a language very well"},
    {w:"fluent",d:"able to speak a language very well"},
    {w:"frustrating",d:"making you feel annoyed because you can't achieve something"},
    {w:"give up",d:"to stop trying because something is too difficult"},
    {w:"grade",d:"a letter or number showing the quality of a student's work"},
    {w:"improvement",d:"the state of being better than before"},
    {w:"incompetence",d:"lack of skill or ability to do something well"},
    {w:"maintain",d:"to make something stay the same"},
    {w:"measure",d:"to form an opinion about how good or bad something is"},
    {w:"mistake",d:"something you have done or said incorrectly"},
    {w:"motivated",d:"enthusiastic and determined to achieve success"},
    {w:"period",d:"an amount of time during which something happens"},
    {w:"plateau",d:"a period when something stops improving"},
    {w:"progress",d:"the process of developing or improving"},
    {w:"push yourself",d:"to try very hard to achieve something"},
    {w:"rarely",d:"not very often"},
    {w:"secure",d:"feeling confident and safe"},
    {w:"stage",d:"a particular part of a process that has several parts"},
    {w:"take risks",d:"to do things knowing something bad could happen"},
    {w:"theory",d:"an idea or set of ideas that explains something"},
    {w:"unconscious",d:"a feeling or thought you don't realise you have"},
    {w:"volunteer work",d:"work you do without being paid"},
    {w:"yet",d:"used for something that hasn't happened but probably will"},
  ],
  2: [
    {w:"ability",d:"the fact of being able to do something"},
    {w:"academic",d:"good at learning things by studying"},
    {w:"amygdala",d:"the part of the brain that processes emotions and memories"},
    {w:"associate something with",d:"to form a connection in your mind between different things"},
    {w:"attitude",d:"someone's opinions or feelings about something"},
    {w:"bored",d:"feeling impatient because you are not interested in something"},
    {w:"childhood",d:"the time of your life when you are a child"},
    {w:"cognitive",d:"connected with recognising and understanding things"},
    {w:"cue",d:"something that tells someone indirectly what to do"},
    {w:"danger",d:"a situation where harm or damage is possible"},
    {w:"dementia",d:"a serious illness where someone gradually loses their memory"},
    {w:"emotion",d:"a feeling such as love, fear or anger"},
    {w:"emotional",d:"relating to feelings and how they affect your life"},
    {w:"experiment",d:"a scientific test to find out what happens in certain conditions"},
    {w:"findings",d:"information you discover after doing research"},
    {w:"immediately",d:"without delay"},
    {w:"implication",d:"a possible effect or result of something"},
    {w:"lifetime",d:"the period of time when someone is alive"},
    {w:"memory",d:"the ability to remember things"},
    {w:"memory loss",d:"when you cannot remember things"},
    {w:"olfactory cortex",d:"the part of the brain where our sense of smell is processed"},
    {w:"personality",d:"the part of a person that makes them behave in a particular way"},
    {w:"physiology",d:"the way that the body of a living thing operates"},
    {w:"recognise",d:"to know who or what something is because you've seen it before"},
    {w:"remind",d:"to make someone think of something else because it is similar"},
    {w:"research",d:"detailed study to discover new facts"},
    {w:"response",d:"a reaction to something"},
    {w:"sense of smell",d:"the natural ability to smell things"},
    {w:"stimuli",d:"things that produce a reaction in a person or animal"},
    {w:"survival",d:"the fact of continuing to live, especially in difficult conditions"},
    {w:"think back",d:"to think about something that happened in the past"},
    {w:"transport",d:"to make you feel as if you are in a different place or time"},
    {w:"vivid",d:"producing very clear and detailed images in the mind"},
    {w:"youth",d:"the time in someone's life when they are young"},
  ],
  3: [
    {w:"accessories",d:"small things like jewellery you wear to give your clothes more style"},
    {w:"advertise",d:"to tell people about a product to make them buy it"},
    {w:"beauty salon",d:"a shop where you can get treatments for your skin, hair or nails"},
    {w:"blow",d:"to spend a lot of money quickly on things you don't need"},
    {w:"celebrity",d:"a famous person, especially in entertainment or sport"},
    {w:"choice",d:"the opportunity or right to choose between different things"},
    {w:"complaint",d:"a statement saying you are not satisfied with something"},
    {w:"credit card",d:"a card you use to buy things now and pay for them later"},
    {w:"department store",d:"a large shop divided into sections, each selling different things"},
    {w:"designer",d:"describing clothes made by a famous designer, usually expensive"},
    {w:"discount",d:"a reduction in the price of something"},
    {w:"exchange",d:"to give something in return for something else"},
    {w:"fashion",d:"the activity involving styles of clothes and people's appearance"},
    {w:"fashion icon",d:"a famous person who is very fashionable and people like to copy"},
    {w:"formal",d:"an important or official event where people wear special clothes"},
    {w:"groomed",d:"tidy and clean in your appearance"},
    {w:"image-conscious",d:"giving a lot of attention to the way you look"},
    {w:"influence",d:"the effect a person or thing has on someone's decisions"},
    {w:"inspiration",d:"something that gives you new ideas and enthusiasm"},
    {w:"jewellery",d:"objects like rings and necklaces that you wear as decoration"},
    {w:"keep up with",d:"to do or learn at the same speed as someone or something"},
    {w:"lad",d:"a boy or a young man"},
    {w:"makeover",d:"a set of changes to make a person look much better"},
    {w:"market",d:"to use advertising to persuade people to buy something"},
    {w:"outfit",d:"a set of clothes worn together"},
    {w:"persuade",d:"to make someone agree to do something by giving them reasons"},
    {w:"prom",d:"a formal dance for secondary school students at the end of year"},
    {w:"refund",d:"money you get back because you paid too much"},
    {w:"smarten up",d:"to make yourself look tidier and cleaner"},
    {w:"snowball",d:"to develop quickly and become very big"},
    {w:"suit",d:"a set of clothes made from the same cloth, usually jacket and trousers"},
    {w:"teenage",d:"between the ages of 13 and 19"},
    {w:"treatment",d:"a procedure at a beauty salon for your health or beauty"},
    {w:"tuxedo",d:"a man's black or white jacket worn on formal occasions"},
  ]
};

// ═══════════════════════════════════════════════════
// STATE
// ═══════════════════════════════════════════════════
let studentName = '';
let selectedUnit = null;
let webhookUrl = localStorage.getItem('gsheet_webhook') || '';
let questions = [];
let currentQ = 0;
let correctCount = 0;
let wrongCount = 0;
let timerSec = 0;
let timerInterval = null;
let typeStats = { 'MC: Def → Word': [0,0], 'MC: Word → Def': [0,0], 'True / False': [0,0], 'Written Answer': [0,0] };
let missedWords = [];

// Load saved webhook
if (webhookUrl) {
  setTimeout(() => {
    const el = document.getElementById('webhook-url');
    if (el) el.value = webhookUrl;
    document.getElementById('webhook-saved').style.display = 'block';
  }, 300);
}

// Input listeners for enabling start button
document.getElementById('student-name').addEventListener('input', checkReady);
function checkReady() {
  const name = document.getElementById('student-name').value.trim();
  document.getElementById('start-btn').disabled = !(name && selectedUnit);
}

function selectUnit(u) {
  selectedUnit = u;
  document.querySelectorAll('.unit-btn').forEach(b => b.classList.remove('selected'));
  event.target.closest('.unit-btn').classList.add('selected');
  checkReady();
}

function saveWebhook() {
  const val = document.getElementById('webhook-url').value.trim();
  if (val) {
    webhookUrl = val;
    localStorage.setItem('gsheet_webhook', val);
    document.getElementById('webhook-saved').style.display = 'block';
  }
}

// ═══════════════════════════════════════════════════
// QUIZ BUILD
// ═══════════════════════════════════════════════════
function buildWordPool() {
  if (selectedUnit === 'all') {
    return [...WORDS[1], ...WORDS[2], ...WORDS[3]];
  }
  return [...WORDS[parseInt(selectedUnit)]];
}

function shuffle(arr) {
  const a = [...arr];
  for (let i = a.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}

function getDistractors(correct, pool, field, n = 3) {
  const others = pool.filter(w => w[field] !== correct[field]).map(w => w[field]);
  return shuffle(others).slice(0, n);
}

function buildQuestions(pool) {
  const shuffledPool = shuffle(pool);
  const selected = shuffledPool.slice(0, Math.min(30, shuffledPool.length));
  const allWords = shuffle([...WORDS[1], ...WORDS[2], ...WORDS[3]]);

  const types = ['mc-dw', 'mc-wd', 'tf', 'written'];
  // Distribute: ~10 mc-dw, ~10 mc-wd, ~5 tf, ~5 written
  const typeDist = ['mc-dw','mc-dw','mc-dw','mc-dw','mc-dw','mc-dw','mc-dw','mc-dw','mc-dw','mc-dw',
                    'mc-wd','mc-wd','mc-wd','mc-wd','mc-wd','mc-wd','mc-wd','mc-wd','mc-wd','mc-wd',
                    'tf','tf','tf','tf','tf',
                    'written','written','written','written','written'];
  const shuffledTypes = shuffle(typeDist);

  return selected.map((word, i) => {
    const type = shuffledTypes[i % shuffledTypes.length];
    return { word, type, allWords };
  });
}

// ═══════════════════════════════════════════════════
// RENDER QUESTION
// ═══════════════════════════════════════════════════
function renderQuestion() {
  const wrap = document.getElementById('q-card-wrap');
  const qData = questions[currentQ];
  const { word, type, allWords } = qData;
  const unitLabel = getUnitLabel(word);

  document.getElementById('q-num').textContent = currentQ + 1;
  document.getElementById('progress-bar').style.width = ((currentQ / 30) * 100) + '%';

  let html = `<div class="q-card">`;
  html += `<div class="q-unit-tag">${unitLabel}</div>`;

  if (type === 'mc-dw') {
    // Show definition → pick word
    const distractors = getDistractors(word, allWords, 'w');
    const options = shuffle([word.w, ...distractors]);
    const ci = options.indexOf(word.w);
    html += `<div class="q-type-badge"><span class="dot"></span>Multiple Choice</div>`;
    html += `<div class="q-text"><span class="def-text">"${word.d}"</span><br><small style="font-size:14px;font-weight:400;color:var(--muted);font-family:'Plus Jakarta Sans',sans-serif;margin-top:8px;display:block">Which word matches this definition?</small></div>`;
    html += `<div class="mc-options">`;
    options.forEach((opt, i) => {
      html += `<button class="mc-opt" onclick="answerMC(${i},${ci},'MC: Def → Word','${escQ(word.w)}')" id="mco-${i}"><span class="opt-key">${'ABCD'[i]}</span>${opt}</button>`;
    });
    html += `</div>`;
    html += `<div class="feedback-row" id="feedback"></div>`;

  } else if (type === 'mc-wd') {
    // Show word → pick definition
    const distractors = getDistractors(word, allWords, 'd');
    const options = shuffle([word.d, ...distractors]);
    const ci = options.indexOf(word.d);
    html += `<div class="q-type-badge"><span class="dot"></span>Multiple Choice</div>`;
    html += `<div class="q-text">What does <span class="word-highlight">${word.w}</span> mean?</div>`;
    html += `<div class="mc-options">`;
    options.forEach((opt, i) => {
      html += `<button class="mc-opt" onclick="answerMC(${i},${ci},'MC: Word → Def','${escQ(word.w)}')" id="mco-${i}"><span class="opt-key">${'ABCD'[i]}</span>${opt}</button>`;
    });
    html += `</div>`;
    html += `<div class="feedback-row" id="feedback"></div>`;

  } else if (type === 'tf') {
    // True / False — either correct def or swapped with another word
    const isTrue = Math.random() > 0.5;
    let displayDef, correctAnswer;
    if (isTrue) {
      displayDef = word.d;
      correctAnswer = 'True';
    } else {
      const other = shuffle(allWords.filter(w => w.w !== word.w))[0];
      displayDef = other.d;
      correctAnswer = 'False';
    }
    html += `<div class="q-type-badge"><span class="dot"></span>True / False</div>`;
    html += `<div class="q-text"><span class="word-highlight">${word.w}</span> means: <span class="def-text">"${displayDef}"</span></div>`;
    html += `<div class="tf-options">`;
    html += `<button class="tf-btn" onclick="answerTF('True','${correctAnswer}','${escQ(word.w)}','${escQ(word.d)}')" id="tfb-True">True</button>`;
    html += `<button class="tf-btn" onclick="answerTF('False','${correctAnswer}','${escQ(word.w)}','${escQ(word.d)}')" id="tfb-False">False</button>`;
    html += `</div>`;
    html += `<div class="feedback-row" id="feedback"></div>`;

  } else if (type === 'written') {
    html += `<div class="q-type-badge"><span class="dot"></span>Written Answer</div>`;
    html += `<div class="q-text"><span class="def-text">"${word.d}"</span><br><small style="font-size:14px;font-weight:400;color:var(--muted);font-family:'Plus Jakarta Sans',sans-serif;margin-top:8px;display:block">Type the word or phrase.</small></div>`;
    html += `<div class="written-wrap">`;
    html += `<input class="written-input" id="written-in" type="text" placeholder="Type your answer…" autocomplete="off" onkeydown="if(event.key==='Enter')submitWritten('${escQ(word.w)}')">`;
    html += `<button class="submit-btn" onclick="submitWritten('${escQ(word.w)}')">Check →</button>`;
    html += `</div>`;
    html += `<div class="feedback-row" id="feedback"></div>`;
  }

  html += `</div>`;
  wrap.innerHTML = html;

  if (type === 'written') {
    setTimeout(() => { const el = document.getElementById('written-in'); if(el) el.focus(); }, 100);
  }
}

function escQ(s) { return (s||'').replace(/'/g,"\\'").replace(/"/g,'&quot;'); }

function getUnitLabel(word) {
  for (const u of [1,2,3]) {
    if (WORDS[u].find(w => w.w === word.w)) return `Unit ${u}`;
  }
  return '';
}

// ═══════════════════════════════════════════════════
// ANSWER HANDLERS
// ═══════════════════════════════════════════════════
function answerMC(chosen, correct, qtype, wordStr) {
  const isCorrect = chosen === correct;
  recordAnswer(isCorrect, qtype, wordStr);

  // Style buttons
  for (let i = 0; i < 4; i++) {
    const btn = document.getElementById(`mco-${i}`);
    if (!btn) continue;
    btn.disabled = true;
    if (i === correct) btn.classList.add('correct');
    else if (i === chosen && !isCorrect) btn.classList.add('wrong');
    else btn.classList.add('dim');
  }

  showFeedback(isCorrect, wordStr, questions[currentQ].word.w, qtype);
  setTimeout(nextQuestion, 1400);
}

function answerTF(chosen, correct, wordStr, defStr) {
  const isCorrect = chosen === correct;
  recordAnswer(isCorrect, 'True / False', wordStr);

  ['True','False'].forEach(v => {
    const btn = document.getElementById(`tfb-${v}`);
    if (!btn) return;
    btn.disabled = true;
    if (v === correct) btn.classList.add('correct');
    else if (v === chosen && !isCorrect) btn.classList.add('wrong');
  });

  showFeedback(isCorrect, wordStr, wordStr, 'True / False', defStr);
  setTimeout(nextQuestion, 1600);
}

function submitWritten(correctWord) {
  const input = document.getElementById('written-in');
  if (!input) return;
  const val = input.value.trim().toLowerCase();
  const correct = correctWord.toLowerCase();
  const isCorrect = val === correct || val.replace(/-/g,' ') === correct.replace(/-/g,' ');

  input.disabled = true;
  document.querySelector('.submit-btn').disabled = true;
  input.classList.add(isCorrect ? 'correct' : 'wrong');

  recordAnswer(isCorrect, 'Written Answer', correctWord);
  showFeedback(isCorrect, correctWord, correctWord, 'Written Answer');
  setTimeout(nextQuestion, 1800);
}

function recordAnswer(isCorrect, qtype, word) {
  if (isCorrect) {
    correctCount++;
    document.getElementById('live-correct').textContent = correctCount;
    typeStats[qtype][0]++;
  } else {
    wrongCount++;
    document.getElementById('live-wrong').textContent = wrongCount;
    if (!missedWords.includes(word)) missedWords.push(word);
  }
  typeStats[qtype][1]++;
}

function showFeedback(isCorrect, wordStr, correctWord, qtype, extra) {
  const fb = document.getElementById('feedback');
  if (!fb) return;
  fb.className = `feedback-row show ${isCorrect ? 'correct-fb' : 'wrong-fb'}`;
  if (isCorrect) {
    fb.innerHTML = `✓ Correct! <span class="fb-answer">Well done.</span>`;
  } else {
    fb.innerHTML = `✗ Incorrect. <span class="fb-answer">Correct answer: <strong>${correctWord}</strong></span>`;
  }
}

// ═══════════════════════════════════════════════════
// NAVIGATION
// ═══════════════════════════════════════════════════
function nextQuestion() {
  currentQ++;
  if (currentQ >= 30 || currentQ >= questions.length) {
    endQuiz();
  } else {
    renderQuestion();
  }
}

// ═══════════════════════════════════════════════════
// START / END
// ═══════════════════════════════════════════════════
function startQuiz() {
  studentName = document.getElementById('student-name').value.trim();
  const pool = buildWordPool();
  questions = buildQuestions(pool);

  // Reset state
  currentQ = 0; correctCount = 0; wrongCount = 0; timerSec = 0;
  missedWords = [];
  typeStats = { 'MC: Def → Word': [0,0], 'MC: Word → Def': [0,0], 'True / False': [0,0], 'Written Answer': [0,0] };
  document.getElementById('live-correct').textContent = '0';
  document.getElementById('live-wrong').textContent = '0';

  showScreen('screen-quiz');
  renderQuestion();

  timerInterval = setInterval(() => {
    timerSec++;
    const m = String(Math.floor(timerSec/60)).padStart(2,'0');
    const s = String(timerSec%60).padStart(2,'0');
    document.getElementById('timer-disp').textContent = `${m}:${s}`;
  }, 1000);
}

function endQuiz() {
  clearInterval(timerInterval);
  document.getElementById('progress-bar').style.width = '100%';

  const pct = Math.round(correctCount / 30 * 100);
  const m = String(Math.floor(timerSec/60)).padStart(2,'0');
  const s = String(timerSec%60).padStart(2,'0');
  const timeStr = `${m}:${s}`;

  // Set results
  const title = pct >= 90 ? ['Outstanding', '<em>Result!</em>'] :
                pct >= 75 ? ['Great', '<em>Work!</em>'] :
                pct >= 60 ? ['Good', '<em>Effort!</em>'] :
                pct >= 40 ? ['Keep', '<em>Practising!</em>'] :
                ['Review the', '<em>Wordlist!</em>'];
  document.getElementById('results-title').innerHTML = title[0] + '<br>' + title[1];
  document.getElementById('student-result-name').textContent = studentName + ' · Unit ' + (selectedUnit === 'all' ? 'All (Mixed)' : selectedUnit);
  document.getElementById('res-score').textContent = correctCount;
  document.getElementById('res-pct').textContent = `${pct}% — ${correctCount} correct out of 30`;
  document.getElementById('res-correct').textContent = correctCount;
  document.getElementById('res-wrong').textContent = wrongCount;
  document.getElementById('res-time').textContent = timeStr;

  // Type breakdown
  const bd = document.getElementById('type-breakdown');
  bd.innerHTML = '';
  Object.entries(typeStats).forEach(([label, [c, t]]) => {
    if (t === 0) return;
    const p = Math.round(c/t*100);
    bd.innerHTML += `<div class="type-row">
      <div class="type-label">${label}</div>
      <div class="type-bar-wrap"><div class="type-bar-fill" style="width:${p}%"></div></div>
      <div class="type-stat">${c}/${t}</div>
    </div>`;
  });

  // Hard words
  const hw = document.getElementById('hard-words-list');
  if (missedWords.length === 0) {
    hw.innerHTML = `<span class="none-msg">✓ No words missed — perfect vocabulary!</span>`;
  } else {
    hw.innerHTML = missedWords.map(w => `<span class="hard-word-chip">${w}</span>`).join('');
  }

  showScreen('screen-results');
  sendToSheets(pct, timeStr);
}

// ═══════════════════════════════════════════════════
// GOOGLE SHEETS
// ═══════════════════════════════════════════════════
function sendToSheets(pct, timeStr) {
  if (!webhookUrl) return;

  const status = document.getElementById('sheets-status');
  status.style.display = 'flex';
  status.className = 'sheets-status sending';
  status.innerHTML = '<span>⏳</span> Sending results to Google Sheets…';

  const byType = {};
  Object.entries(typeStats).forEach(([label, [c, t]]) => {
    if (t > 0) byType[label] = `${c}/${t}`;
  });

  const payload = {
    student: studentName,
    unit: selectedUnit === 'all' ? 'All Units (Mixed)' : `Unit ${selectedUnit}`,
    score: correctCount,
    total: 30,
    percent: pct,
    timeSec: timerSec,
    correct: correctCount,
    wrong: wrongCount,
    byType,
    hardWords: missedWords
  };

  fetch(webhookUrl, {
    method: 'POST',
    mode: 'no-cors',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(payload)
  }).then(() => {
    status.className = 'sheets-status sent';
    status.innerHTML = '✓ Results saved to Google Sheets!';
  }).catch(() => {
    status.className = 'sheets-status failed';
    status.innerHTML = '✗ Could not reach Google Sheets. Check your webhook URL in setup.';
  });
}

function showScreen(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  window.scrollTo(0,0);
}
</script>
</body>
</html>
